end_time <- df$time[which(df$`b_ex_5%` > 0)][length(which(df$`b_ex_5%` > 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_10%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_10%` > 0)][1]
end_time <- df$time[which(df$`b_ex_10%` > 0)][length(which(df$`b_ex_10%` > 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_15%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_15%` > 0)][1]
end_time <- df$time[which(df$`b_ex_15%` > 0)][length(which(df$`b_ex_15%` > 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_20%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_20%` > 0)][1]
end_time <- df$time[which(df$`b_ex_20%` > 0)][length(which(df$`b_ex_20%` > 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_25%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_25%` > 0)][1]
end_time <- df$time[which(df$`b_ex_25%` > 0)][length(which(df$`b_ex_25%` > 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_10%` > 0)) > 0){
start_time <- df$time[which(df$`b_ex_10%` > 0)][1]
end_time <- df$time[which(df$`b_ex_10%` > 0)][length(which(df$`b_ex_10%` > 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_15%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_15%` > 0)][1]
end_time <- df$time[which(df$`b_ex_15%` > 0)][length(which(df$`b_ex_15%` > 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_20%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_20%` > 0)][1]
end_time <- df$time[which(df$`b_ex_20%` > 0)][length(which(df$`b_ex_20%` > 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_25%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_25%` > 0)][1]
end_time <- df$time[which(df$`b_ex_25%` > 0)][length(which(df$`b_ex_25%` > 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_15%` > 0)) > 0){
start_time <- df$time[which(df$`b_ex_15%` > 0)][1]
end_time <- df$time[which(df$`b_ex_15%` > 0)][length(which(df$`b_ex_15%` > 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_20%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_20%` > 0)][1]
end_time <- df$time[which(df$`b_ex_20%` > 0)][length(which(df$`b_ex_20%` > 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_25%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_25%` > 0)][1]
end_time <- df$time[which(df$`b_ex_25%` > 0)][length(which(df$`b_ex_25%` > 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_20%` > 0)) > 0){
start_time <- df$time[which(df$`b_ex_20%` > 0)][1]
end_time <- df$time[which(df$`b_ex_20%` > 0)][length(which(df$`b_ex_20%` > 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_25%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_25%` > 0)][1]
end_time <- df$time[which(df$`b_ex_25%` > 0)][length(which(df$`b_ex_25%` > 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_25%` > 0)) > 0){
start_time <- df$time[which(df$`b_ex_25%` > 0)][1]
end_time <- df$time[which(df$`b_ex_25%` > 0)][length(which(df$`b_ex_25%` > 0))] + 1
move_time <- end_time - start_time
}else{
start_time <- Inf
end_time <- Inf
move_time <- Inf
}
}else{  # ex_sign == "negative"
if(length(which(df$`b_ex_97.5%` < 0)) > 0){
start_time <- df$time[which(df$`b_ex_97.5%` < 0)][1]
end_time <- df$time[which(df$`b_ex_97.5%` < 0)][length(which(df$`b_ex_97.5%` < 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_95%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_95%` < 0)][1]
end_time <- df$time[which(df$`b_ex_95%` < 0)][length(which(df$`b_ex_95%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_90%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_90%` < 0)][1]
end_time <- df$time[which(df$`b_ex_90%` < 0)][length(which(df$`b_ex_90%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_85%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_85%` < 0)][1]
end_time <- df$time[which(df$`b_ex_85%` < 0)][length(which(df$`b_ex_85%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_80%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_80%` < 0)][1]
end_time <- df$time[which(df$`b_ex_80%` < 0)][length(which(df$`b_ex_80%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_75%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_75%` < 0)][1]
end_time <- df$time[which(df$`b_ex_75%` < 0)][length(which(df$`b_ex_75%` < 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_95%` < 0)) > 0){
start_time <- df$time[which(df$`b_ex_95%` < 0)][1]
end_time <- df$time[which(df$`b_ex_95%` < 0)][length(which(df$`b_ex_95%` < 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_90%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_90%` < 0)][1]
end_time <- df$time[which(df$`b_ex_90%` < 0)][length(which(df$`b_ex_90%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_85%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_85%` < 0)][1]
end_time <- df$time[which(df$`b_ex_85%` < 0)][length(which(df$`b_ex_85%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_80%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_80%` < 0)][1]
end_time <- df$time[which(df$`b_ex_80%` < 0)][length(which(df$`b_ex_80%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_75%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_75%` < 0)][1]
end_time <- df$time[which(df$`b_ex_75%` < 0)][length(which(df$`b_ex_75%` < 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_90%` < 0)) > 0){
start_time <- df$time[which(df$`b_ex_90%` < 0)][1]
end_time <- df$time[which(df$`b_ex_90%` < 0)][length(which(df$`b_ex_90%` < 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_85%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_85%` < 0)][1]
end_time <- df$time[which(df$`b_ex_85%` < 0)][length(which(df$`b_ex_85%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_80%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_80%` < 0)][1]
end_time <- df$time[which(df$`b_ex_80%` < 0)][length(which(df$`b_ex_80%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_75%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_75%` < 0)][1]
end_time <- df$time[which(df$`b_ex_75%` < 0)][length(which(df$`b_ex_75%` < 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_85%` < 0)) > 0){
start_time <- df$time[which(df$`b_ex_85%` < 0)][1]
end_time <- df$time[which(df$`b_ex_85%` < 0)][length(which(df$`b_ex_85%` < 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_80%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_80%` < 0)][1]
end_time <- df$time[which(df$`b_ex_80%` < 0)][length(which(df$`b_ex_80%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_75%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_75%` < 0)][1]
end_time <- df$time[which(df$`b_ex_75%` < 0)][length(which(df$`b_ex_75%` < 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_80%` < 0)) > 0){
start_time <- df$time[which(df$`b_ex_80%` < 0)][1]
end_time <- df$time[which(df$`b_ex_80%` < 0)][length(which(df$`b_ex_80%` < 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_75%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_75%` < 0)][1]
end_time <- df$time[which(df$`b_ex_75%` < 0)][length(which(df$`b_ex_75%` < 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_75%` < 0)) > 0){
start_time <- df$time[which(df$`b_ex_75%` < 0)][1]
end_time <- df$time[which(df$`b_ex_75%` < 0)][length(which(df$`b_ex_75%` < 0))] + 1
move_time <- end_time - start_time
}else{
start_time <- Inf
end_time <- Inf
move_time <- Inf
}
}
mv_time <- data.frame(start_time = start_time, end_time = end_time, move_time = move_time)
df_mv <- rbind(df_mv, mv_time)
df_mv
# Load data
data("cell1", "cell2", "cell3", "cell4", "visual")
cell_list <- list(cell1, cell2, cell3, cell4)
cell_list = test
# Prepare data_list
data_list <- list(
N = nrow(cell_list[[i]])-1,
N_ex = length(which(cell_list[[i]]$ex==1)),
ex = cell_list[[i]]$ex[-1],
Y = diff(cell_list[[i]][,j+2])
)
data_list$N == data_list2$N
data_list$N_ex == data_list2$N_ex
data_list$ex == data_list2$ex
data_list$Y == data_list2$Y
# Execute MCMC
fit <- model$sample(
data = data_list2,
seed = 10,
iter_warmup = warmup*thin,
iter_sampling = sampling*thin,
chains = 4,
parallel_chains = 4,
refresh = floor(warmup/2.5*thin),
#show_messages = F,
#sig_figs = 4,
output_dir = output_dir,
output_basename = paste0("cell", i, "_", res_name, j),
adapt_delta = 0.95,
thin = thin
)
# 99% Bayesian credible intervals
outcsv_name <- list.files(output_dir)
outcsv_name <- outcsv_name[grep(paste0("cell", i, "_", res_name, j, "-"), outcsv_name)]
tmp_csv_w <- NULL
tmp_csv_b_ex <- NULL
tmp_csv_alpha <- NULL
tmp_csv_s_w <- NULL
tmp_csv_s_b_ex <- NULL
tmp_csv_s_Y <- NULL
for(k in 1:length(outcsv_name)){
tmp_csv <- as.data.frame(data.table::fread(cmd = paste0("grep -v '^#' ", output_dir, "/", outcsv_name[k])))
tmp_csv_w <- rbind(tmp_csv_w, tmp_csv[,stringr::str_starts(names(tmp_csv), "w")])
tmp_csv_b_ex <- rbind(tmp_csv_b_ex, tmp_csv[,stringr::str_starts(names(tmp_csv), "b_ex")])
tmp_csv_alpha <- rbind(tmp_csv_alpha, tmp_csv[,stringr::str_starts(names(tmp_csv), "alpha")])
tmp_csv_s_w <- c(tmp_csv_s_w, tmp_csv[,stringr::str_starts(names(tmp_csv), "s_w")])
tmp_csv_s_b_ex <- c(tmp_csv_s_b_ex, tmp_csv[,stringr::str_starts(names(tmp_csv), "s_b_ex")])
tmp_csv_s_Y <- c(tmp_csv_s_Y, tmp_csv[,stringr::str_starts(names(tmp_csv), "s_Y")])
}
df_w <- as.data.frame(t(apply(tmp_csv_w, 2, quantile99)))
df_b_ex <- as.data.frame(t(apply(tmp_csv_b_ex, 2, quantile99)))
df_alpha <- as.data.frame(t(apply(tmp_csv_alpha, 2, quantile99)))
df_s <- t(data.frame(s_w = quantile99(tmp_csv_s_w),
s_b_ex = quantile99(tmp_csv_s_b_ex),
s_Y = quantile99(tmp_csv_s_Y)))
df_s <- cbind(data.frame(s_name = row.names(df_s)), df_s)
# Save output
colnames(df_w) <- paste0("w_", colnames(df_w))
colnames(df_b_ex) <- paste0("b_ex_", colnames(df_b_ex))
colnames(df_alpha) <- paste0("alpha_", colnames(df_alpha))
df <- cbind(data.frame(time = cell_list[[i]]$time[-1],
ex = cell_list[[i]]$ex[-1],
Y = diff(cell_list[[i]][,j+2])),
df_w, df_alpha,
as.data.frame(rbind(matrix(NA, nrow = data_list2$boundary1, ncol = 21), as.matrix(df_b_ex), matrix(NA, nrow = data_list2$N - data_list2$boundary2 + 1, ncol = 21))))
data.table::fwrite(df, file = paste0(out, "/csv/ssm_individual_", df_name, i, "_", res_name, j, ".csv"))
data.table::fwrite(df_s, file = paste0(out, "/csv/ssm_individual_", df_name, i, "_", res_name, j, "_sd.csv"))
## Movement time
ex_period <- max(cell_list[[i]]$time[cell_list[[i]]$ex == 1], na.rm = T) - min(cell_list[[i]]$time[cell_list[[i]]$ex == 1], na.rm = T) + 1
if(ex_sign == "positive"){  # ex_sign == "positive"
if(length(which(df$`b_ex_2.5%` > 0)) > 0){
start_time <- df$time[which(df$`b_ex_2.5%` > 0)][1]
end_time <- df$time[which(df$`b_ex_2.5%` > 0)][length(which(df$`b_ex_2.5%` > 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_5%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_5%` > 0)][1]
end_time <- df$time[which(df$`b_ex_5%` > 0)][length(which(df$`b_ex_5%` > 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_10%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_10%` > 0)][1]
end_time <- df$time[which(df$`b_ex_10%` > 0)][length(which(df$`b_ex_10%` > 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_15%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_15%` > 0)][1]
end_time <- df$time[which(df$`b_ex_15%` > 0)][length(which(df$`b_ex_15%` > 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_20%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_20%` > 0)][1]
end_time <- df$time[which(df$`b_ex_20%` > 0)][length(which(df$`b_ex_20%` > 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_25%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_25%` > 0)][1]
end_time <- df$time[which(df$`b_ex_25%` > 0)][length(which(df$`b_ex_25%` > 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_5%` > 0)) > 0){
start_time <- df$time[which(df$`b_ex_5%` > 0)][1]
end_time <- df$time[which(df$`b_ex_5%` > 0)][length(which(df$`b_ex_5%` > 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_10%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_10%` > 0)][1]
end_time <- df$time[which(df$`b_ex_10%` > 0)][length(which(df$`b_ex_10%` > 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_15%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_15%` > 0)][1]
end_time <- df$time[which(df$`b_ex_15%` > 0)][length(which(df$`b_ex_15%` > 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_20%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_20%` > 0)][1]
end_time <- df$time[which(df$`b_ex_20%` > 0)][length(which(df$`b_ex_20%` > 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_25%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_25%` > 0)][1]
end_time <- df$time[which(df$`b_ex_25%` > 0)][length(which(df$`b_ex_25%` > 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_10%` > 0)) > 0){
start_time <- df$time[which(df$`b_ex_10%` > 0)][1]
end_time <- df$time[which(df$`b_ex_10%` > 0)][length(which(df$`b_ex_10%` > 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_15%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_15%` > 0)][1]
end_time <- df$time[which(df$`b_ex_15%` > 0)][length(which(df$`b_ex_15%` > 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_20%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_20%` > 0)][1]
end_time <- df$time[which(df$`b_ex_20%` > 0)][length(which(df$`b_ex_20%` > 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_25%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_25%` > 0)][1]
end_time <- df$time[which(df$`b_ex_25%` > 0)][length(which(df$`b_ex_25%` > 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_15%` > 0)) > 0){
start_time <- df$time[which(df$`b_ex_15%` > 0)][1]
end_time <- df$time[which(df$`b_ex_15%` > 0)][length(which(df$`b_ex_15%` > 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_20%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_20%` > 0)][1]
end_time <- df$time[which(df$`b_ex_20%` > 0)][length(which(df$`b_ex_20%` > 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_25%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_25%` > 0)][1]
end_time <- df$time[which(df$`b_ex_25%` > 0)][length(which(df$`b_ex_25%` > 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_20%` > 0)) > 0){
start_time <- df$time[which(df$`b_ex_20%` > 0)][1]
end_time <- df$time[which(df$`b_ex_20%` > 0)][length(which(df$`b_ex_20%` > 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_25%` > 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_25%` > 0)][1]
end_time <- df$time[which(df$`b_ex_25%` > 0)][length(which(df$`b_ex_25%` > 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_25%` > 0)) > 0){
start_time <- df$time[which(df$`b_ex_25%` > 0)][1]
end_time <- df$time[which(df$`b_ex_25%` > 0)][length(which(df$`b_ex_25%` > 0))] + 1
move_time <- end_time - start_time
}else{
start_time <- Inf
end_time <- Inf
move_time <- Inf
}
}else{  # ex_sign == "negative"
if(length(which(df$`b_ex_97.5%` < 0)) > 0){
start_time <- df$time[which(df$`b_ex_97.5%` < 0)][1]
end_time <- df$time[which(df$`b_ex_97.5%` < 0)][length(which(df$`b_ex_97.5%` < 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_95%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_95%` < 0)][1]
end_time <- df$time[which(df$`b_ex_95%` < 0)][length(which(df$`b_ex_95%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_90%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_90%` < 0)][1]
end_time <- df$time[which(df$`b_ex_90%` < 0)][length(which(df$`b_ex_90%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_85%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_85%` < 0)][1]
end_time <- df$time[which(df$`b_ex_85%` < 0)][length(which(df$`b_ex_85%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_80%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_80%` < 0)][1]
end_time <- df$time[which(df$`b_ex_80%` < 0)][length(which(df$`b_ex_80%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_75%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_75%` < 0)][1]
end_time <- df$time[which(df$`b_ex_75%` < 0)][length(which(df$`b_ex_75%` < 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_95%` < 0)) > 0){
start_time <- df$time[which(df$`b_ex_95%` < 0)][1]
end_time <- df$time[which(df$`b_ex_95%` < 0)][length(which(df$`b_ex_95%` < 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_90%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_90%` < 0)][1]
end_time <- df$time[which(df$`b_ex_90%` < 0)][length(which(df$`b_ex_90%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_85%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_85%` < 0)][1]
end_time <- df$time[which(df$`b_ex_85%` < 0)][length(which(df$`b_ex_85%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_80%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_80%` < 0)][1]
end_time <- df$time[which(df$`b_ex_80%` < 0)][length(which(df$`b_ex_80%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_75%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_75%` < 0)][1]
end_time <- df$time[which(df$`b_ex_75%` < 0)][length(which(df$`b_ex_75%` < 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_90%` < 0)) > 0){
start_time <- df$time[which(df$`b_ex_90%` < 0)][1]
end_time <- df$time[which(df$`b_ex_90%` < 0)][length(which(df$`b_ex_90%` < 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_85%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_85%` < 0)][1]
end_time <- df$time[which(df$`b_ex_85%` < 0)][length(which(df$`b_ex_85%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_80%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_80%` < 0)][1]
end_time <- df$time[which(df$`b_ex_80%` < 0)][length(which(df$`b_ex_80%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_75%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_75%` < 0)][1]
end_time <- df$time[which(df$`b_ex_75%` < 0)][length(which(df$`b_ex_75%` < 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_85%` < 0)) > 0){
start_time <- df$time[which(df$`b_ex_85%` < 0)][1]
end_time <- df$time[which(df$`b_ex_85%` < 0)][length(which(df$`b_ex_85%` < 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_80%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_80%` < 0)][1]
end_time <- df$time[which(df$`b_ex_80%` < 0)][length(which(df$`b_ex_80%` < 0))] + 1
move_time <- end_time - start_time
}
if((start_time - df$time[which(df$`b_ex_75%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_75%` < 0)][1]
end_time <- df$time[which(df$`b_ex_75%` < 0)][length(which(df$`b_ex_75%` < 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_80%` < 0)) > 0){
start_time <- df$time[which(df$`b_ex_80%` < 0)][1]
end_time <- df$time[which(df$`b_ex_80%` < 0)][length(which(df$`b_ex_80%` < 0))] + 1
move_time <- end_time - start_time
if((start_time - df$time[which(df$`b_ex_75%` < 0)][1]) > ex_period/start_sensitivity){
start_time <- df$time[which(df$`b_ex_75%` < 0)][1]
end_time <- df$time[which(df$`b_ex_75%` < 0)][length(which(df$`b_ex_75%` < 0))] + 1
move_time <- end_time - start_time
}
}else if(length(which(df$`b_ex_75%` < 0)) > 0){
start_time <- df$time[which(df$`b_ex_75%` < 0)][1]
end_time <- df$time[which(df$`b_ex_75%` < 0)][length(which(df$`b_ex_75%` < 0))] + 1
move_time <- end_time - start_time
}else{
start_time <- Inf
end_time <- Inf
move_time <- Inf
}
}
mv_time <- data.frame(start_time = start_time, end_time = end_time, move_time = move_time)
df_mv <- rbind(df_mv, mv_time)
df_mv
set.seed(-1)
set.seed(-0.5)
# Execute MCMC
fit <- model$sample(
data = data_list2,
seed = -0.1,
iter_warmup = warmup*thin,
iter_sampling = sampling*thin,
chains = 4,
parallel_chains = 4,
refresh = floor(warmup/2.5*thin),
#show_messages = F,
#sig_figs = 4,
output_dir = output_dir,
output_basename = paste0("cell", i, "_", res_name, j),
adapt_delta = 0.95,
thin = thin
)
help("sample")
help("set.seed")
### Test the package
devtools::document()
devtools::build_manual()
usethis::use_testthat()
### Test the package
devtools::document()
devtools::build_manual()
usethis::use_testthat()
#usethis::use_test()
devtools::test()
devtools::check()
### Test the package
devtools::document()
devtools::build_manual()
usethis::use_testthat()
#usethis::use_test()
devtools::test()
devtools::check()
### Test the package
devtools::document()
devtools::build_manual()
usethis::use_testthat()
### Test the package
devtools::document()
devtools::build_manual()
#install.packages("devtools")
devtools::install_github("hnishio/cellssm")
